(()=>{"use strict";var e=document.querySelector("#element-template").content;function t(e){var t=e.getAttribute("data-card-id");fetch("https://nomoreparties.co/v1/wff-cohort-5/cards/".concat(t),{method:"DELETE",headers:{authorization:"94722f8e-9854-4848-81d1-a8145df88ee4","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(t){e.remove()}))}function n(e){var t=e.target,n=t.closest(".element"),r=n.getAttribute("data-card-id"),c=n.querySelector(".element__like-count");t.classList.contains("element__like-button_active")?fetch("https://nomoreparties.co/v1/wff-cohort-5/cards/likes/".concat(r),{method:"DELETE",headers:{authorization:"94722f8e-9854-4848-81d1-a8145df88ee4","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){c.textContent=e.likes.length,function(e){e.classList.remove("element__like-button_active")}(t)})):fetch("https://nomoreparties.co/v1/wff-cohort-5/cards/likes/".concat(r),{method:"PUT",headers:{authorization:"94722f8e-9854-4848-81d1-a8145df88ee4","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){c.textContent=e.likes.length,o(t)}))}function o(e){e.classList.add("element__like-button_active")}function r(t,n,r){var c=n.deleteCard,a=n.likeCard,i=n.handleImageClick,u=e.querySelector(".element").cloneNode(!0),l=u.querySelector(".element__title"),s=u.querySelector(".element__image"),d=u.querySelector(".element__like-count"),p=u.querySelector(".element__delete-button");return l.textContent=t.name,s.src=t.link,s.alt="Фотография: ".concat(t.name),d.textContent=t.likes.length,t.likes.forEach((function(e){e._id==r._id&&o(u.querySelector(".element__like-button"))})),r._id!=t.owner._id?p.style.display="none":u.querySelector(".element__delete-button").addEventListener("click",(function(){c(u)})),u.setAttribute("data-card-id",t.id),u.querySelector(".element__like-button").addEventListener("click",a),u.querySelector(".element__image").addEventListener("click",i),u}var c=/^[а-яА-Яa-zA-ZЁё\-\s]*$/;function a(e,t,n){t.classList.remove(n.inputErrorClass);var o=e.querySelector(".".concat(t.id,"-error"));o.textContent="",o.classList.remove(n.errorClass)}function i(e,t,n){!function(e){var t=!1;return e.forEach((function(e){e.hasAttribute("data-text-error")&&!c.test(e.value)&&(t=!0)})),e.some((function(e){return!e.validity.valid}))&&(t=!0),t}(e)?function(e,t){e.classList.remove(t.inactiveButtonClass),e.disabled=!1}(t,n):u(t,n)}function u(e,t){e.classList.add(t.inactiveButtonClass),e.disabled=!0}function l(e){e.classList.add("popup_opened"),window.addEventListener("keydown",s)}function s(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");t&&d(t)}}function d(e){e.classList.remove("popup_opened"),window.removeEventListener("keydown",s);var t=e.querySelector("form");null!=t&&function(e,t){e.querySelectorAll("input").forEach((function(n){a(e,n,t)}))}(t,J)}var p={baseUrl:"https://nomoreparties.co/v1/wff-cohort-5",headers:{authorization:"94722f8e-9854-4848-81d1-a8145df88ee4","Content-Type":"application/json"}};function f(e,t){e.textContent=t}var m=document.querySelector(".profile-info__edit-button"),_=document.querySelector(".profile__add-button"),v=document.querySelector(".popup_edit_profile"),h=document.querySelector(".popup_add_element"),y=document.querySelector(".popup_image_active"),S=document.querySelector(".popup_avatar_edit"),q=document.querySelector(".popup__input_type_name"),k=document.querySelector(".popup__input_type_job"),b=document.querySelector(".popup__input_type_place"),C=document.querySelector(".popup__input_type_link"),E=document.querySelector(".popup__input_type_avatar"),L=document.querySelector(".profile-info__title"),g=document.querySelector(".profile-info__intro"),x=document.querySelector(".profile__avatar"),A=document.querySelectorAll(".popup__close"),w=document.querySelector(".profile__wrapper"),j=document.querySelector(".elements__container"),T=(document.querySelector("#element-template").content,document.querySelector(".popup__image")),P=document.querySelector(".popup__description"),U=h.querySelector(".popup__button"),z=v.querySelector(".popup__button"),B=S.querySelector(".popup__button"),D=document.forms["profile-info"],N=document.forms["avatar-form"],O=document.forms["card-form"],I={},J={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function G(e){var o=r({name:e.name,link:e.link,likes:e.likes,owner:e.owner,id:e._id},{deleteCard:t,likeCard:n,handleImageClick:H},I);j.append(o)}function H(e){l(y);var t=e.target,n=t.closest(".element").querySelector(".element__title").textContent;P.textContent=n,T.src=t.src,T.alt="Фотография: ".concat(n)}O.addEventListener("submit",(function(e){e.preventDefault(),function(e,t,n){return f(n,"Создание..."),fetch("".concat(p.baseUrl,"/cards"),{method:"POST",headers:p.headers,body:JSON.stringify({name:e.value,link:t.value})})}(b,C,U).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(o){f(U,"Создать"),u(U,J);var c=r({name:o.name,link:o.link,likes:o.likes,owner:o.owner,id:o._id},{deleteCard:t,likeCard:n,handleImageClick:H},I);j.prepend(c),e.target.reset(),d(h)})).catch((function(e){console.log(e)}))})),A.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return d(t)}))})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup")&&d(e)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);i(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.hasAttribute("data-text-error")&&!c.test(t.value)?function(e,t,n){t.classList.add(n.inputErrorClass);var o=e.querySelector(".".concat(t.id,"-error"));o.textContent=t.getAttribute("data-text-error"),o.classList.add(n.errorClass)}(e,t,n):t.validity.valid?a(e,t,n):function(e,t,n){t.classList.add(n.inputErrorClass);var o=e.querySelector(".".concat(t.id,"-error"));o.textContent=t.validationMessage,o.classList.add(n.errorClass)}(e,t,n)}(e,r,t),i(n,o,t)}))}))}(t,e)}))}(J),D.addEventListener("submit",(function(e){e.preventDefault(),L.textContent=q.value,g.textContent=k.value,function(e,t,n){return f(n,"Сохранение..."),fetch("".concat(p.baseUrl,"/users/me"),{method:"PATCH",headers:p.headers,body:JSON.stringify({name:e.value,about:t.value})})}(q,k,z).then((function(e){f(z,"Сохранить"),u(z,J)})).catch((function(e){console.log(e)})),d(v)})),m.addEventListener("click",(function(){l(v),q.value=L.textContent,k.value=g.textContent})),_.addEventListener("click",(function(){l(h),u(U,J)})),w.addEventListener("click",(function(){l(S)})),N.addEventListener("submit",(function(e){e.preventDefault(),x.setAttribute("src",E.value),function(e,t){return f(t,"Сохранение..."),fetch("".concat(p.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:p.headers,body:JSON.stringify({avatar:e.value})})}(E,B).then((function(e){f(B,"Сохранить"),u(B,J)})).catch((function(e){console.log(e)})),d(S)})),fetch("".concat(p.baseUrl,"/users/me"),{method:"GET",headers:p.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){!function(e){var t;L.textContent=e.name,g.textContent=e.about,t=e.avatar,x.setAttribute("src",t)}(I=e)})).catch((function(e){console.log(e)})),fetch("".concat(p.baseUrl,"/cards"),{method:"GET",headers:p.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach(G)})).catch((function(e){console.log(e)}))})();